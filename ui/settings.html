<div class="vecthare_settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b data-i18n="Vector Storage">Vector Storage</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <div class="flex-container flexFlowColumn">
                <label for="vecthare_source" data-i18n="Vectorization Source">
                    Vectorization Source
                </label>
                <select id="vecthare_source" class="text_pole">
                    <option value="bananabread">BananaBread</option>
                    <option value="cohere">Cohere</option>
                    <option value="electronhub">Electron Hub</option>
                    <option value="extras">Extras (deprecated)</option>
                    <option value="palm">Google AI Studio</option>
                    <option value="vertexai">Google Vertex AI</option>
                    <option value="koboldcpp">KoboldCpp</option>
                    <option value="llamacpp">llama.cpp</option>
                    <option value="transformers" data-i18n="Local (Transformers)">Local (Transformers)</option>
                    <option value="mistral">MistralAI</option>
                    <option value="nomicai">NomicAI</option>
                    <option value="ollama">Ollama</option>
                    <option value="openai">OpenAI</option>
                    <option value="openrouter">OpenRouter</option>
                    <option value="togetherai">TogetherAI</option>
                    <option value="vllm">vLLM</option>
                    <option value="webllm" data-i18n="WebLLM Extension">WebLLM Extension</option>
                </select>
            </div>
            <div class="flex-container flexFlowColumn" id="electronhub_VectHareModel">
                <label for="vecthare_electronhub_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <select id="vecthare_electronhub_model" class="text_pole"></select>
                <i data-i18n="Hint: Set your Electron Hub API key in API Connections.">
                    Hint: Set your Electron Hub API key in API Connections.
                </i>
            </div>
            <div class="flex-container flexFlowColumn" id="vector_altEndpointUrl">
                <label class="checkbox_label" for="vector_altEndpointUrl_enabled" title="Enable secondary endpoint URL usage, instead of the main one.">
                    <input id="vector_altEndpointUrl_enabled" type="checkbox" class="checkbox">
                    <span data-i18n="Use secondary URL">Use secondary URL</span>
                </label>
                <label for="vector_altEndpoint_address" data-i18n="Secondary Embedding endpoint URL">
                    Secondary Embedding endpoint URL
                </label>
                <input id="vector_altEndpoint_address" class="text_pole" type="text" placeholder="e.g. http://localhost:5001" />
            </div>
            <div class="flex-container flexFlowColumn" title="Rate limit settings for API calls. (0 = disabled)">
                <label data-i18n="API Rate Limiting">API Rate Limiting</label>
                <div class="flex-container">
                    <div class="flex1">
                        <label for="vecthare_rate_limit_calls">
                            <small data-i18n="Max Calls">Max Calls</small>
                        </label>
                        <input id="vecthare_rate_limit_calls" class="text_pole" type="number" min="0" placeholder="5" />
                    </div>
                    <div class="flex1">
                        <label for="vecthare_rate_limit_interval">
                            <small data-i18n="Interval (sec)">Interval (sec)</small>
                        </label>
                        <input id="vecthare_rate_limit_interval" class="text_pole" type="number" min="1" placeholder="60" />
                    </div>
                </div>
            </div>
            <div class="flex-container flexFlowColumn" id="webllm_VectHareModel">
                <label for="vecthare_webllm_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <div class="flex-container">
                    <select id="vecthare_webllm_model" class="text_pole flex1">
                    </select>
                    <div id="vecthare_webllm_load" class="menu_button menu_button_icon" title="Verify and load the selected model.">
                        <i class="fa-solid fa-check-to-slot"></i>
                    </div>
                </div>
                <div>
                    Requires the WebLLM extension to be installed. Click <a href="#" id="vecthare_webllm_install">here</a> to install.
                </div>
            </div>
            <div class="flex-container flexFlowColumn" id="ollama_VectHareModel">
                <label for="vecthare_ollama_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <input id="vecthare_ollama_model" class="text_pole" type="text" placeholder="Model tag, e.g. llama3" />
                <label for="vecthare_ollama_keep" class="checkbox_label" title="When checked, the model will not be unloaded after use.">
                    <input id="vecthare_ollama_keep" type="checkbox" />
                    <span data-i18n="Keep model in memory">Keep model in memory</span>
                </label>
                <div>
                    The model must be downloaded first! Do it with the <code>ollama pull</code> command or <a href="#" id="vecthare_ollama_pull">click here</a>.
                </div>
                <i data-i18n="Hint: Set the URL in the API connection settings.">
                    Hint: Set the URL in the API connection settings.
                </i>
            </div>
            <div class="flex-container flexFlowColumn" id="koboldcpp_VectHareModel">
                <span>
                    Set the KoboldCpp URL in the Text Completion API connection settings.
                </span>
                <span>
                    Must use version 1.87 or higher and have an embedding model loaded.
                </span>
            </div>
            <div class="flex-container flexFlowColumn" id="llamacpp_VectHareModel">
                <span data-i18n="The server MUST be started with the --embedding flag to use this feature!">
                    The server MUST be started with the <code>--embedding</code> flag to use this feature!
                </span>
                <i data-i18n="Hint: Set the URL in the API connection settings.">
                    Hint: Set the URL in the API connection settings.
                </i>
            </div>
            <div class="flex-container flexFlowColumn" id="openai_VectHareModel">
                <label for="vecthare_openai_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <select id="vecthare_openai_model" class="text_pole">
                    <option value="text-embedding-ada-002">text-embedding-ada-002</option>
                    <option value="text-embedding-3-small">text-embedding-3-small</option>
                    <option value="text-embedding-3-large">text-embedding-3-large</option>
                </select>
            </div>
            <div class="flex-container flexFlowColumn" id="cohere_VectHareModel">
                <label for="vecthare_cohere_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <select id="vecthare_cohere_model" class="text_pole">
                    <option value="embed-v4.0">embed-v4.0</option>
                    <option value="embed-english-v3.0">embed-english-v3.0</option>
                    <option value="embed-multilingual-v3.0">embed-multilingual-v3.0</option>
                    <option value="embed-english-light-v3.0">embed-english-light-v3.0</option>
                    <option value="embed-multilingual-light-v3.0">embed-multilingual-light-v3.0</option>
                    <option value="embed-english-v2.0">embed-english-v2.0</option>
                    <option value="embed-english-light-v2.0">embed-english-light-v2.0</option>
                    <option value="embed-multilingual-v2.0">embed-multilingual-v2.0</option>
                </select>
            </div>
            <div class="flex-container flexFlowColumn" id="together_VectHareModel">
                <label for="vecthare_togetherai_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <select id="vecthare_togetherai_model" class="text_pole">
                    <option value="togethercomputer/m2-bert-80M-32k-retrieval">M2-BERT-Retrieval-32k</option>
                    <option value="togethercomputer/m2-bert-80M-8k-retrieval">M2-BERT-Retrieval-8k</option>
                    <option value="togethercomputer/m2-bert-80M-2k-retrieval">M2-BERT-Retrieval-2K</option>
                    <option value="WhereIsAI/UAE-Large-V1">UAE-Large-V1</option>
                    <option value="BAAI/bge-large-en-v1.5">BAAI-Bge-Large-1p5</option>
                    <option value="BAAI/bge-base-en-v1.5">BAAI-Bge-Base-1p5</option>
                    <option value="sentence-transformers/msmarco-bert-base-dot-v5">Sentence-BERT</option>
                    <option value="bert-base-uncased">Bert Base Uncased</option>
                </select>
            </div>
            <div class="flex-container flexFlowColumn" id="vllm_VectHareModel">
                <label for="vecthare_vllm_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <input id="vecthare_vllm_model" class="text_pole" type="text" placeholder="Model name, e.g. intfloat/e5-mistral-7b-instruct" />
                <i data-i18n="Hint: Set the URL in the API connection settings.">
                    Hint: Set the URL in the API connection settings.
                </i>
            </div>
            <div class="flex-container flexFlowColumn" id="google_VectHareModel">
                <label for="vecthare_google_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <select id="vecthare_google_model" class="text_pole">
                    <option value="gemini-embedding-001">gemini-embedding-001</option>
                    <option value="gemini-embedding-exp-03-07">gemini-embedding-exp-03-07</option>
                    <option value="text-embedding-004">text-embedding-004</option>
                    <option value="text-embedding-005">text-embedding-005</option>
                    <option value="embedding-001">embedding-001</option>
                </select>
            </div>
            <div class="flex-container alignItemsCenter" id="nomicai_apiKey">
                <label for="api_key_nomicai" class="flex1">
                    <span data-i18n="NomicAI API Key">NomicAI API Key</span>
                </label>
                <div id="api_key_nomicai" class="menu_button menu_button_icon manage-api-keys" data-key="api_key_nomicai">
                    <i class="fa-solid fa-key"></i>
                    <span data-i18n="Click to set">Click to set</span>
                </div>
            </div>
            <div class="flex-container flexFlowColumn" id="openrouter_VectHareModel">
                <label for="vecthare_openrouter_model" data-i18n="Vectorization Model">
                    Vectorization Model
                </label>
                <select id="vecthare_openrouter_model" class="text_pole"></select>
                <div class="flex-container flexFlowColumn marginTop5">
                    <label for="vecthare_openrouter_apikey" data-i18n="OpenRouter API Key">
                        OpenRouter API Key
                    </label>
                    <input type="password" id="vecthare_openrouter_apikey" class="text_pole" placeholder="Paste key here to save..." autocomplete="off" />
                </div>
            </div>

            <!-- Cotton-Tales Emotion Classification Section -->
            <div id="vecthare_cottontales_section" class="flex-container flexFlowColumn marginTopBot5" style="display: none; padding: 10px; border: 1px solid var(--SmartThemeBorderColor); border-radius: 8px; background: linear-gradient(135deg, rgba(139,92,246,0.05), rgba(59,130,246,0.05));">
                <div class="flex-container alignItemsCenter" style="margin-bottom: 8px;">
                    <i class="fa-solid fa-masks-theater" style="color: #8b5cf6; margin-right: 8px;"></i>
                    <b style="color: #8b5cf6;">Cotton-Tales Integration</b>
                </div>
                <small style="margin-bottom: 10px; opacity: 0.8;">
                    Configure how VectHare provides emotion classification to Cotton-Tales.
                </small>

                <!-- Classification Method Selection -->
                <label for="vecthare_emotion_method">
                    <small>Classification Method</small>
                </label>
                <select id="vecthare_emotion_method" class="text_pole">
                    <option value="disabled">Disabled</option>
                    <option value="classifier">Dedicated Classifier Model</option>
                    <option value="similarity">Embedding Similarity (uses your embedding model)</option>
                </select>

                <!-- Dedicated Classifier Settings -->
                <div id="vecthare_classifier_settings" style="display: none; margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.1); border-radius: 4px;">
                    <label for="vecthare_emotion_classifier_model">
                        <small>Classifier Model</small>
                    </label>
                    <select id="vecthare_emotion_classifier_model" class="text_pole">
                        <option value="SamLowe/roberta-base-go_emotions">RoBERTa GoEmotions (28 emotions) - Recommended</option>
                        <option value="j-hartmann/emotion-english-distilroberta-base">DistilRoBERTa (7 emotions) - Faster</option>
                        <option value="bhadresh-savani/distilbert-base-uncased-emotion">DistilBERT (6 emotions) - Lightweight</option>
                        <option value="custom">Custom Model...</option>
                    </select>

                    <div id="vecthare_custom_classifier_model" class="flex-container flexFlowColumn marginTop5" style="display: none;">
                        <label for="vecthare_emotion_classifier_custom">
                            <small>Custom Model ID (HuggingFace)</small>
                        </label>
                        <input id="vecthare_emotion_classifier_custom" class="text_pole" type="text" placeholder="e.g., username/model-name" />
                    </div>

                    <div class="flex-container marginTop5">
                        <div id="vecthare_test_classifier" class="menu_button menu_button_icon" title="Test if the selected model outputs emotion labels">
                            <i class="fa-solid fa-flask"></i>
                            <span>Test Classifier</span>
                        </div>
                    </div>

                    <div id="vecthare_classifier_test_result" class="marginTop5" style="display: none; padding: 8px; border-radius: 4px;">
                        <!-- Test results shown here -->
                    </div>
                </div>

                <!-- Embedding Similarity Settings -->
                <div id="vecthare_similarity_settings" style="display: none; margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.1); border-radius: 4px;">
                    <small style="opacity: 0.8; display: block;">
                        <i class="fa-solid fa-info-circle"></i>
                        Compares message text against emotion descriptions using your configured embedding model.
                        The emotion with the highest cosine similarity score is selected.
                    </small>
                    <small style="opacity: 0.6; display: block; margin-top: 5px;">
                        Currently using: <b id="vecthare_similarity_source_display">transformers</b>
                    </small>
                </div>
            </div>

            <div class="flex-container marginTopBot5">
                <div class="flex-container flex1 flexFlowColumn" title="How many recent messages to include when building the search query. Higher = broader context for finding relevant content, but slower.">
                    <label for="vecthare_query">
                        <small data-i18n="Query depth">Query depth</small>
                    </label>
                    <input type="number" id="vecthare_query" class="text_pole" min="1" max="99" />
                </div>
                <div class="flex-container flex1 flexFlowColumn" title="Cut-off score for relevance. Helps to filter out irrelevant data.">
                    <label for="vecthare_score_threshold">
                        <small data-i18n="Score threshold">Score threshold</small>
                    </label>
                    <input type="number" id="vecthare_score_threshold" class="text_pole" min="0" max="1" step="0.05" />
                </div>
                <div class="flex-container flex1 flexFlowColumn" title="Number of recent messages to check for duplicates. Lower values improve performance and allow older messages to be re-injected. 0 = check entire chat.">
                    <label for="vecthare_deduplication_depth">
                        <small data-i18n="Dedup depth">Dedup depth</small>
                    </label>
                    <input type="number" id="vecthare_deduplication_depth" class="text_pole" min="0" max="500" step="10" />
                </div>
                <div class="flex-container flex1 flexFlowColumn" title="Prioritize chunking on the preferred delimiter.">
                    <label for="vecthare_force_chunk_delimiter">
                        <small data-i18n="Chunk boundary">Chunk boundary</small>
                    </label>
                    <textarea id="vecthare_force_chunk_delimiter" class="text_pole" rows="1" placeholder="(None)"></textarea>
                </div>
            </div>

            <div class="flex-container">
                <label class="checkbox_label expander" for="vecthare_include_wi" title="Query results can activate World Info entries.">
                    <input id="vecthare_include_wi" type="checkbox" class="checkbox">
                    <span data-i18n="Include in World Info Scanning">Include in World Info Scanning</span>
                </label>
            </div>

            <hr>

            <h4 data-i18n="World Info settings">
                World Info settings
            </h4>

            <label class="checkbox_label" for="vecthare_enabled_world_info" title="Enable semantic activation of World Info entries from vectorized lorebooks based on chat context similarity.">
                <input id="vecthare_enabled_world_info" type="checkbox" class="checkbox">
                <span data-i18n="Enable Semantic WI Activation">Enable Semantic WI Activation</span>
            </label>

            <div id="vecthare_world_info_settings" class="marginTopBot5">
                <div class="flex-container marginBot10">
                    <small style="opacity: 0.8; line-height: 1.4;">
                        <i class="fa-solid fa-info-circle"></i>
                        Activates World Info entries from <strong>vectorized lorebooks</strong> based on semantic similarity to recent chat messages.
                        Complements keyword-based activation. Use the <strong>Content Vectorizer</strong> to vectorize your lorebooks first.
                    </small>
                </div>

                <div class="flex-container">
                    <div class="flex1 flexFlowColumn" title="Minimum similarity score required to activate a WI entry (0.0-1.0)">
                        <label for="vecthare_world_info_threshold">
                            <small data-i18n="Score Threshold">Score Threshold</small>
                        </label>
                        <input id="vecthare_world_info_threshold" type="number" class="text_pole" min="0" max="1" step="0.05" value="0.3" />
                    </div>
                    <div class="flex1 flexFlowColumn" title="Maximum number of entries to activate per vectorized lorebook">
                        <label for="vecthare_world_info_top_k">
                            <small data-i18n="Top-K per Lorebook">Top-K per Lorebook</small>
                        </label>
                        <input id="vecthare_world_info_top_k" type="number" class="text_pole" min="1" max="20" value="3" />
                    </div>
                    <div class="flex1 flexFlowColumn" title="Number of recent messages to use for building the search query">
                        <label for="vecthare_world_info_query_depth">
                            <small data-i18n="Query Depth">Query Depth</small>
                        </label>
                        <input id="vecthare_world_info_query_depth" type="number" class="text_pole" min="1" max="10" value="3" />
                    </div>
                </div>

                <div class="flex-container marginTop10">
                    <label for="vecthare_enabled_for_all" class="checkbox_label">
                        <input id="vecthare_enabled_for_all" type="checkbox" />
                        <span data-i18n="Enabled for all entries">Enabled for all entries</span>
                    </label>
                    <ul class="margin0">
                        <li>
                            <small data-i18n="Checked: all entries except ‚ùå status can be activated.">Checked: all entries except ‚ùå status can be activated.</small>
                        </li>
                        <li>
                            <small data-i18n="Unchecked: only entries with ‚ùå status can be activated.">Unchecked: only entries with üîó status can be activated.</small>
                        </li>
                    </ul>
                </div>
                <div class="flex-container">
                    <div class="flex1">
                        <!--  Vacant for future use -->
                    </div>
                    <div class="flex1" title="Maximum number of entries to be activated">
                        <label for="vecthare_max_entries" >
                            <small data-i18n="Max Entries">Max Entries</small>
                        </label>
                        <input id="vecthare_max_entries" type="number" class="text_pole widthUnset" min="1" max="9999" />
                    </div>
                    <div class="flex1">
                        <!--  Vacant for future use -->
                    </div>
                </div>
            </div>

            <h4 data-i18n="File vectorization settings">
                File vectorization settings
            </h4>

            <label class="checkbox_label" for="vecthare_enabled_files">
                <input id="vecthare_enabled_files" type="checkbox" class="checkbox">
                <span data-i18n="Enable for files">Enable for files</span>
            </label>

            <div id="vecthare_files_settings" class="marginTopBot5">
                <label class="checkbox_label" for="vecthare_only_custom_boundary" title="Create a chunk for every custom Chunk boundary detected in the file text. Don't chunk on default boundaries.">
                    <input id="vecthare_only_custom_boundary" type="checkbox" class="checkbox">
                    <span data-i18n="Only chunk on custom boundary">
                        Only chunk on custom boundary
                    </span>
                </label>
                <label class="checkbox_label" for="vecthare_translate_files" title="This can help with retrieval accuracy if using embedding models that are trained on English data. Uses the selected API from Chat Translation extension settings.">
                    <input id="vecthare_translate_files" type="checkbox" class="checkbox">
                    <span data-i18n="Translate files into English before processing">
                        Translate files into English before processing
                    </span>
                    <i class="fa-solid fa-flask" title="Experimental feature"></i>
                </label>
                <div class="flex justifyCenter" title="These settings apply to files attached directly to messages.">
                    <span data-i18n="Message attachments">Message attachments</span>
                </div>
                <div class="flex-container">
                    <div class="flex1" title="Only files past this size will be vectorized.">
                        <label for="vecthare_size_threshold">
                            <small data-i18n="Size threshold (KB)">Size threshold (KB)</small>
                        </label>
                        <input id="vecthare_size_threshold" type="number" class="text_pole" min="1" max="99999" />
                    </div>
                    <div class="flex1" title="Chunk size for file splitting.">
                        <label for="vecthare_chunk_size">
                            <small data-i18n="Chunk size (chars)">Chunk size (chars)</small>
                        </label>
                        <input id="vecthare_chunk_size" type="number" class="text_pole" min="1" max="99999" />
                    </div>
                    <div class="flex1" title="The overlap between adjacent chunks in % from chunk size. The overlap text is trimmed to sentence boundaries. 0 = disabled.">
                        <label for="vecthare_overlap_percent">
                            <small data-i18n="Chunk overlap (%)">Chunk overlap (%)</small>
                        </label>
                        <input id="vecthare_overlap_percent" type="number" class="text_pole" min="0" max="99" step="1" />
                    </div>
                    <div class="flex1" title="How many chunks to retrieve when querying.">
                        <label for="vecthare_chunk_count">
                            <small data-i18n="Retrieve chunks">Retrieve chunks</small>
                        </label>
                        <input id="vecthare_chunk_count" type="number" class="text_pole" min="1" max="99999" />
                    </div>
                </div>
                <div class="flex justifyCenter" title="These settings apply to files stored in the Data Bank.">
                    <span data-i18n="Data Bank files">Data Bank files</span>
                </div>
                <div class="flex-container">
                    <div class="flex1" title="Only files past this size will be vectorized.">
                        <label for="vecthare_size_threshold_db">
                            <small data-i18n="Size threshold (KB)">Size threshold (KB)</small>
                        </label>
                        <input id="vecthare_size_threshold_db" type="number" class="text_pole" min="1" max="99999" />
                    </div>
                    <div class="flex1" title="Chunk size for file splitting.">
                        <label for="vecthare_chunk_size_db">
                            <small data-i18n="Chunk size (chars)">Chunk size (chars)</small>
                        </label>
                        <input id="vecthare_chunk_size_db" type="number" class="text_pole" min="1" max="99999" />
                    </div>
                    <div class="flex1" title="The overlap between adjacent chunks in % from chunk size. The overlap text is trimmed to sentence boundaries. 0 = disabled.">
                        <label for="vecthare_overlap_percent_db">
                            <small data-i18n="Chunk overlap (%)">Chunk overlap (%)</small>
                        </label>
                        <input id="vecthare_overlap_percent_db" type="number" class="text_pole" min="0" max="99" step="1" />
                    </div>
                    <div class="flex1" title="How many chunks to retrieve when querying.">
                        <label for="vecthare_chunk_count_db">
                            <small data-i18n="Retrieve chunks">Retrieve chunks</small>
                        </label>
                        <input id="vecthare_chunk_count_db" type="number" class="text_pole" min="1" max="99999" />
                    </div>
                </div>
                <div class="flex-container flexFlowColumn">
                    <label for="vecthare_file_position_db" data-i18n="Injection Position">Injection Position</label>
                    <div class="radio_group">
                        <label>
                            <input type="radio" name="vecthare_file_position_db" value="2" />
                            <span data-i18n="Before Main Prompt / Story String">Before Main Prompt / Story String</span>
                        </label>
                        <!--Keep these as 0 and 1 to interface with the setExtensionPrompt function-->
                        <label>
                            <input type="radio" name="vecthare_file_position_db" value="0" />
                            <span data-i18n="After Main Prompt / Story String">After Main Prompt / Story String</span>
                        </label>
                        <label for="vecthare_file_depth_db" title="How many messages before the current end of the chat." data-i18n="[title]How many messages before the current end of the chat.">
                            <input type="radio" name="vecthare_file_position_db" value="1" />
                            <span data-i18n="In-chat @ Depth">In-chat @ Depth</span>
                            <input id="vecthare_file_depth_db" class="text_pole widthUnset" type="number" min="0" max="9999" />
                            <span>as</span>
                            <select id="vecthare_file_depth_role_db"  class="text_pole widthNatural">
                                <option value="0" data-i18n="System">System</option>
                                <option value="1" data-i18n="User">User</option>
                                <option value="2" data-i18n="Assistant">Assistant</option>
                            </select>
                        </label>
                    </div>
                </div>
                <div class="flex-container">
                    <div id="vecthare_files_vectorize_all" class="menu_button menu_button_icon" title="Vectorize all files in the Data Bank and current chat.">
                        <span data-i18n="Vectorize All">Vectorize All</span>
                    </div>
                    <div id="vecthare_files_purge" class="menu_button menu_button_icon" title="Purge all file VectHare in the Data Bank and current chat.">
                        <span data-i18n="Purge VectHare">Purge VectHare</span>
                    </div>
                </div>
            </div>

            <hr>

            <h4 data-i18n="Chat vectorization settings">
                Chat vectorization settings
            </h4>
            <label class="checkbox_label" for="vecthare_autosync_enabled">
                <input id="vecthare_autosync_enabled" type="checkbox" class="checkbox">
                <span data-i18n="Enable Auto-Sync">Enable Auto-Sync</span>
            </label>

            <hr>

            <div id="vecthare_chats_settings">
                <div id="vecthare_advanced_settings">
                    <label for="vecthare_position" data-i18n="Injection Position">Injection Position</label>
                    <div class="radio_group">
                        <label>
                            <input type="radio" name="vecthare_position" value="2" />
                            <span data-i18n="Before Main Prompt / Story String">Before Main Prompt / Story String</span>
                        </label>
                        <!--Keep these as 0 and 1 to interface with the setExtensionPrompt function-->
                        <label>
                            <input type="radio" name="vecthare_position" value="0" />
                            <span data-i18n="After Main Prompt / Story String">After Main Prompt / Story String</span>
                        </label>
                        <label for="vecthare_depth" title="How many messages before the current end of the chat." data-i18n="[title]How many messages before the current end of the chat.">
                            <input type="radio" name="vecthare_position" value="1" />
                            <span data-i18n="In-chat @ Depth">In-chat @ Depth </span>
                            <input id="vecthare_depth" class="text_pole widthUnset" type="number" min="0" max="9999" />
                        </label>
                    </div>
                    <div class="flex-container">
                        <div class="flex1" title="Target chunk size for adaptive strategy. Unit strategies ignore this.">
                            <label for="vecthare_chunk_size">
                                <small data-i18n="Chunk size (adaptive)">Chunk size (adaptive)</small>
                            </label>
                            <input id="vecthare_chunk_size" type="number" class="text_pole widthUnset" min="100" max="9999" />
                        </div>
                        <div class="flex1" title="Prevents last N messages from being placed out of order.">
                            <label for="vecthare_protect">
                                <small data-i18n="Retain#">Retain#</small>
                            </label>
                            <input type="number" id="vecthare_protect" class="text_pole widthUnset" min="1" max="9999" />
                        </div>
                        <div class="flex1" title="Minimum number of messages in chat before RAG injection starts (0 = no minimum).">
                            <label for="vecthare_min_chat_length">
                                <small>Min Chat Length</small>
                            </label>
                            <input type="number" id="vecthare_min_chat_length" class="text_pole widthUnset" min="0" max="9999" />
                        </div>
                        <div class="flex1" title="How many past messages to insert as memories.">
                            <label for="vecthare_insert">
                                <small data-i18n="Insert#">Insert#</small>
                            </label>
                            <input type="number" id="vecthare_insert" class="text_pole widthUnset" min="1" max="9999" />
                        </div>
                    </div>
                    <hr class="m-b-1">
                    <div class="flex-container flexFlowColumn">
                        <div class="flex-container alignitemscenter justifyCenter">
                            <i class="fa-solid fa-flask" title="Summarization for VectHare is an experimental feature that may improve VectHare or may worsen them. Use at your own discretion."></i>
                            <span data-i18n="Vector Summarization">Vector Summarization</span>
                        </div>
                        <label class="checkbox_label expander" for="vecthare_summarize" title="Summarize chat messages before generating embeddings.">
                            <input id="vecthare_summarize" type="checkbox" class="checkbox">
                            <span data-i18n="Summarize chat messages for vector generation">Summarize chat messages for vector generation</span>
                        </label>
                        <i class="failure" data-i18n="Warning: This will slow down vector generation drastically, as all messages have to be summarized first.">Warning: This will slow down vector generation drastically, as all messages have to be summarized first.</i>

                        <label class="checkbox_label expander" for="vecthare_summarize_user" title="Summarize sent chat messages before generating embeddings.">
                            <input id="vecthare_summarize_user" type="checkbox" class="checkbox">
                            <span data-i18n="Summarize chat messages when sending">Summarize chat messages when sending</span>
                        </label>
                        <i class="failure" data-i18n="Warning: This might cause your sent messages to take a bit to process and slow down response time.">Warning: This might cause your sent messages to take a bit to process and slow down response time.</i>

                        <label for="vecthare_summary_source" title="Summarize with:">Summarize with:</label>
                        <select id="vecthare_summary_source" class="text_pole">
                            <option value="main" data-i18n="Main API">Main API</option>
                            <option value="extras" data-i18n="Extras API">Extras API</option>
                            <option value="webllm" data-i18n="WebLLM Extension">WebLLM Extension</option>
                        </select>

                        <label for="vecthare_summary_prompt" title="Summary Prompt:">Summary Prompt:</label>
                        <small data-i18n="Only used when Main API or WebLLM Extension is selected.">Only used when Main API or WebLLM Extension is selected.</small>
                        <textarea id="vecthare_summary_prompt" class="text_pole textarea_compact" rows="6" placeholder="This prompt will be sent to AI to request the summary generation."></textarea>
                    </div>
                </div>
                <small data-i18n="Old messages are vectorized gradually as you chat. To process all previous messages, click the button below.">
                    Old messages are vectorized gradually as you chat.
                    To process all previous messages, click the button below.
                </small>
                <div class="flex-container">
                    <div id="vecthare_vectorize_all" class="menu_button menu_button_icon" data-i18n="Vectorize All">
                        Vectorize All
                    </div>
                    <div id="vecthare_purge" class="menu_button menu_button_icon" data-i18n="Purge VectHare">
                        Purge VectHare
                    </div>
                    <div id="vecthare_view_stats" class="menu_button menu_button_icon" data-i18n="View Stats">
                        View Stats
                    </div>
                </div>
                <div id="vectorize_progress" style="display: none;">
                    <small>
                        Processed <span id="vectorize_progress_percent">0</span>% of messages.
                        ETA: <span id="vectorize_progress_eta">...</span> seconds.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
